<!--
 * =====================================================================
 *  This Ant script build a folder with all iSphere help pages.
 * ===================================================================== -->
<project basedir="." default="build">

	<!-- Load project names and new version number -->
	<property file="build.properties" />


	<!-- Set workspace home directory -->
	<property name="workspace.home" location="${basedir}/../.." />

	<!-- Set directory names -->
	<property name="build.dir" location="${workspace.home}/${build.project.name}/build" />
	<property name="build.project.dir" location="${build.dir}/.." />
	<property name="build.template.dir" location="${build.dir}/templates" />
	<property name="build.upload.dir" location="${build.project.dir}/upload" />
	<property name="build.lib.dir" location="${build.project.dir}/lib" />
	<property name="build.bin.dir" location="${build.project.dir}/bin" />
	
	<!--
    * =====================================================================
    *   Controls the build process:
    *     - update version number
    * ===================================================================== -->
	<target name="build" depends="cleanUpload,runHelpBuilder" description="build iSphere update site">
		<echo>*** Finished iSphere help build ***</echo>
	</target>

	
	<!--
    * =====================================================================
    *   Cleans the 'upload' directory.
    * ===================================================================== -->
	<target name="cleanUpload" >

		
		<echo>Cleaning help builder upload directory ...</echo>

		<delete includeEmptyDirs="true">
			<fileset dir="${build.upload.dir}" includes="**/*" />
		</delete>
		
		<eclipse.refreshLocal resource="${build.project.name}" depth="infinite" />
		
	</target>

	<!--
    * =====================================================================
    *   Calls the HelpBuilder Java class to build the help pages
    *   from the iSphere help projects.
    * ===================================================================== -->
	<target name="runHelpBuilder" >

		<echo>Copying template files and folders ...</echo>
		<copy todir="${build.upload.dir}">
			<fileset dir="${build.template.dir}/upload">
				<exclude name="**/.svn" />
			</fileset>
		</copy>
		
		<java classname="biz.isphere.core.helpbuilder.HelpBuilder">
			<arg value="${build.dir}/build.properties"/>
    		<classpath>
				<pathelement location="${build.bin.dir}"/>
				<pathelement location="${build.lib.dir}/commons-io-2.2.jar"/>
				<pathelement location="${build.lib.dir}/xstream-1.4.7.jar"/>
			</classpath>
		</java>
		
		<eclipse.refreshLocal resource="${build.project.name}" depth="infinite" />
		
	</target>
	
</project>